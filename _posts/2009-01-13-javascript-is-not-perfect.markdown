---
layout: post
status: publish
published: true
title: JavaScript is Not Perfect
author: justin
author_login: justin
author_email: jmtulloss@gmail.com
author_url: http://
wordpress_id: 140
wordpress_url: http://justin.harmonize.fm/?p=140
date: 2009-01-13 02:38:47.000000000 -08:00
categories:
- Development
tags:
- JavaScript
- Cobra
comments:
- id: 104
  author: links for 2009-02-05 &laquo; pabloidz
  author_email: ''
  author_url: http://pabloidz.wordpress.com/2009/02/05/links-for-2009-02-05/
  date: '2009-02-05 08:01:42 -0800'
  date_gmt: '2009-02-05 12:01:42 -0800'
  content: '[...] JavaScript is Not Perfect Caffeinated Simpleton (tags: javascript)         Blogroll
    [...]'
- id: 106
  author: BinnyVA
  author_email: comments@binnyva.com
  author_url: http://blog.binnyva.com/
  date: '2009-02-06 18:42:37 -0800'
  date_gmt: '2009-02-06 23:42:37 -0800'
  content: Another problem with JS is the + overloading. It has caused a huge number
    of bugs in my apps. Also <a href="http://www.openjs.com/articles/semicolon_insertion.php"
    rel="nofollow">semi-colon insertion</a> is a potential problem - although I have
    not had any problem with it yet.
- id: 110
  author: justin
  author_email: jmtulloss@gmail.com
  author_url: http://justin.harmonize.fm
  date: '2009-02-09 08:46:44 -0800'
  date_gmt: '2009-02-09 13:46:44 -0800'
  content: I haven&#39;t found + overloading to be a huge problem. Since there are
    so few types that support +, understanding how it works is usually not terribly
    difficult. Changing how + works is much harder, since there are no hooks into
    the underlying implementation in JavaScript.<br><br>Semi-colon insertion is definitely
    a weird JS quirk. Not a whole lot you can do about it though, except make sure
    you have semi-colons everywhere. JSLint (<a href="http://www.jslint.com/" rel="nofollow">http://www.jslint.com/</a>)
    is a great tool for finding these types of bugs.
- id: 639
  author: '123456'
  author_email: ''
  author_url: http://www.123456.com
  date: '2011-07-17 07:28:03 -0700'
  date_gmt: '2011-07-17 15:28:03 -0700'
  content: |-
    <strong>Gems form the internet...</strong>

    [...]very few websites that happen to be detailed below, from our point of view are undoubtedly well worth checking out[...]…...
- id: 1032
  author: WoW Adult
  author_email: ''
  author_url: http://wowadult.net/tag/ariana
  date: '2011-12-10 02:15:27 -0800'
  date_gmt: '2011-12-10 10:15:27 -0800'
  content: |-
    <strong>WoW Adult...</strong>

    [...]JavaScript is Not Perfect[...]...
- id: 1045
  author: WoW e!Book
  author_email: ''
  author_url: http://wowebook.net/category/business/page/9
  date: '2011-12-12 01:22:16 -0800'
  date_gmt: '2011-12-12 09:22:16 -0800'
  content: |-
    <strong>WoW e!Book...</strong>

    [...]JavaScript is Not Perfect[...]...
- id: 1066
  author: Guaranteed Facebook Fans
  author_email: ''
  author_url: http://www.buyguaranteed-facebookfans.info/
  date: '2011-12-14 08:24:57 -0800'
  date_gmt: '2011-12-14 16:24:57 -0800'
  content: |-
    <strong>Extra Reading...</strong>

    [...]we like to honor other sites on the web, even if they aren't related to us, by linking to them. Below are some sites worth checking out[...]...
- id: 1099
  author: Buy Targeted Fans
  author_email: ''
  author_url: http://www.buy-targetedfacebook-fans.info/
  date: '2011-12-20 13:19:51 -0800'
  date_gmt: '2011-12-20 21:19:51 -0800'
  content: |-
    <strong>Recommended Resources...</strong>

    [...]the time to read or visit the content or sites we have linked to below the[...]...
- id: 1138
  author: !binary |-
    cHl0YW5pYSBkbyB6bG90eWNoIG15xZtsaQ==
  author_email: ''
  author_url: http://pyt-odp.pl
  date: '2011-12-25 22:50:06 -0800'
  date_gmt: '2011-12-26 06:50:06 -0800'
  content: |-
    <strong>pytania do zlotych myśli...</strong>

    [...]JavaScript is Not Perfect[...]...
- id: 1751
  author: bwzbnkqh
  author_email: aofuao@xwjavy.com
  author_url: http://laqbncnuvgmi.com/
  date: '2012-05-01 04:30:18 -0700'
  date_gmt: '2012-05-01 12:30:18 -0700'
  content: A90F8H  <a href="http://aycxqtfwdjhl.com/" rel="nofollow">aycxqtfwdjhl</a>,
    [url=http://mftjfqkdodzp.com/]mftjfqkdodzp[/url], [link=http://dvvzzrpsednn.com/]dvvzzrpsednn[/link],
    http://rulykwdfbujx.com/
- id: 1972
  author: Fernandoodoo
  author_email: maryh@housingdatasystems.com
  author_url: http://www.facebook.com/profile.php?id=100003406002556
  date: '2012-05-21 02:25:55 -0700'
  date_gmt: '2012-05-21 10:25:55 -0700'
  content: Если дальше работа идёт с $object, то наверно небольшая :-)Согласен, надо
    было привести пример с пэкэджем, в котором определено 150 inline констант, которые
    надо вызывать типаReally::Long::Package::Names::You::Cant::Remember-&gt;USEFUL_CONSTANT_1Really::Long::Package::Names::You::Cant::Remember-&gt;USEFUL_CONSTANT_2Really::Long::Package::Names::You::Cant::Remember-&gt;USEFUL_CONSTANT_3
- id: 2128
  author: Sun
  author_email: typsygypsys@typsygypsys.com
  author_url: http://www.facebook.com/profile.php?id=100003406010185
  date: '2012-05-23 20:56:26 -0700'
  date_gmt: '2012-05-24 04:56:26 -0700'
  content: emilia                окт 08, 2009 -                                  В
    google redear за тази статия заедно с линк към страницата на фирмата ми излиза
    и един линк към  п**но фото костарева людмила   )) Помислих, че си забелязъл,
    но
- id: 2139
  author: Lynsey
  author_email: brownp5@k12tn.net
  author_url: http://www.google.com/
  date: '2012-05-23 22:30:25 -0700'
  date_gmt: '2012-05-24 06:30:25 -0700'
  content: None can doubt the veracity of this aritcle.
- id: 2148
  author: buy levitra
  author_email: Hordyk@ymail.com
  author_url: http://www.levitrabuy.us
  date: '2012-05-24 06:22:49 -0700'
  date_gmt: '2012-05-24 14:22:49 -0700'
  content: http://www.buyadderall.org  Buy adderall
- id: 2238
  author: cialis without prescription
  author_email: Fukuda8@gmail.com
  author_url: http://www.cialis-without-prescription.biz
  date: '2012-05-28 06:50:32 -0700'
  date_gmt: '2012-05-28 14:50:32 -0700'
  content: http://www.viagra-online-without-prescription.us viagra online without
    prescription
- id: 2293
  author: viagra
  author_email: Barias@ymail.com
  author_url: http://www.viagra.gd
  date: '2012-05-30 17:06:55 -0700'
  date_gmt: '2012-05-31 01:06:55 -0700'
  content: Aw, this was a really nice post. In idea I would like to put in writing
    like this additionally – taking time and actual effort to make a very good article…
    but what can I say… I procrastinate alot and by no means seem to get something
    done.
- id: 2490
  author: viagra
  author_email: Breehl@ymail.com
  author_url: http://www.viagra.gd
  date: '2012-06-10 12:20:18 -0700'
  date_gmt: '2012-06-10 20:20:18 -0700'
  content: 'An impressive share, I just given this onto a colleague who was doing
    a little analysis on this. And he in fact bought me breakfast because I found
    it for him.. smile. So let me reword that: Thnx for the treat! But yeah Thnkx
    for spending the time to discuss this, I feel strongly about it and love reading
    more on this topic. If possible, as you become expertise, would you mind updating
    your blog with more details? It is highly helpful for me. Big thumb up for this
    blog post!'
- id: 3427
  author: Jeromy Godbee
  author_email: Beamon@gmail.com
  author_url: http://beatsheadphonesbydr.weebly.com/
  date: '2012-07-18 20:00:10 -0700'
  date_gmt: '2012-07-19 04:00:10 -0700'
  content: http://www.itot54joni.com/2008/03/hbot-for-autism.html
- id: 3658
  author: beats by dre cheap
  author_email: Pierannunzio@gmail.com
  author_url: http://beatsheadphonesbydr.weebly.com/
  date: '2012-07-28 01:17:04 -0700'
  date_gmt: '2012-07-28 09:17:04 -0700'
  content: Human interest At <a href="http://beatsheadphonesbydr.weebly.com/" rel="nofollow">Beats
    By Dre</a>. Those real estate companies put out a press release in varying forms
    and in varying occasions. Thank you!
- id: 4496
  author: making money on the web
  author_email: Hanken2@gmail.com
  author_url: http://mydealsrus.com
  date: '2012-08-30 07:19:37 -0700'
  date_gmt: '2012-08-30 15:19:37 -0700'
  content: Thank you for sharing with us, I believe this website genuinely stands
    out :D.
- id: 4658
  author: kdaqwml
  author_email: dmsosq@rgqote.com
  author_url: http://txrngvvaljsk.com/
  date: '2012-09-05 06:50:03 -0700'
  date_gmt: '2012-09-05 14:50:03 -0700'
  content: PBb0Ib  <a href="http://fdgpnvjfmxfq.com/" rel="nofollow">fdgpnvjfmxfq</a>,
    [url=http://khghxgjqudzo.com/]khghxgjqudzo[/url], [link=http://bdnvxjlfmrtx.com/]bdnvxjlfmrtx[/link],
    http://pbrqibuaioyl.com/
- id: 4755
  author: gewaymomo
  author_email: raljfdfer99098rs@gmail.com
  author_url: http://sacvuittonsonlinesoldes.com/
  date: '2012-09-08 07:51:26 -0700'
  date_gmt: '2012-09-08 15:51:26 -0700'
  content: xjeckwtp <a href="http://vuittonpascher.webnode.fr/#2883" rel="nofollow">sacs
    louis vuittonb</a> rgxgjmjh <a href="http://vuittonpascher.webnode.fr/#5897" rel="nofollow">sac
    louis vuittonv</a> bdyrmbso http://vuittonpascher.webnode.fr/
- id: 5210
  author: how to make money online for beginners
  author_email: Rm6@gmail.com
  author_url: http://mydealsrus.com
  date: '2012-09-24 20:40:39 -0700'
  date_gmt: '2012-09-25 04:40:39 -0700'
  content: Thank you so much for giving everyone an extraordinarily remarkable chance
    to read from this blog. It is often very nice and full of amusement for me personally
    and my office friends to search your site minimum thrice in one week to learn
    the newest tips you have. And of course, I'm at all times contented concerning
    the sensational information you serve. Certain 3 ideas in this posting are unequivocally
    the finest I have ever had.
- id: 5473
  author: how can i make money online free
  author_email: Wariner@ymail.com
  author_url: http://eshopstop.info/CashMasteryPackage/
  date: '2012-09-30 11:46:14 -0700'
  date_gmt: '2012-09-30 19:46:14 -0700'
  content: I cling on to listening to the news speak about receiving boundless online
    grant applications so I have been looking around for the best site to get one.
    Could you advise me please, where could i get some?
- id: 5658
  author: can i really make money online
  author_email: Hanken2@gmail.com
  author_url: http://mydealsrus.com
  date: '2012-10-04 18:39:29 -0700'
  date_gmt: '2012-10-05 02:39:29 -0700'
  content: Lovely just what I was looking for. Thanks to the author for taking his
    clock time on this one.
- id: 5990
  author: youtube adele
  author_email: Laborin1@gmail.com
  author_url: http://mytvbox.info
  date: '2012-10-11 03:44:12 -0700'
  date_gmt: '2012-10-11 11:44:12 -0700'
  content: Thanks a lot for providing individuals with an exceptionally splendid chance
    to discover important secrets from this web site. It really is so good plus jam-packed
    with amusement for me personally and my office friends to search the blog not
    less than thrice in 7 days to study the new things you will have. And indeed,
    we are at all times pleased with your breathtaking information served by you.
    Selected 3 tips in this article are surely the most efficient I've had.
- id: 6055
  author: quick earn
  author_email: Bigney@ymail.com
  author_url: http://myeshopstop.info/products/forex-secrets.htm
  date: '2012-10-12 13:08:48 -0700'
  date_gmt: '2012-10-12 21:08:48 -0700'
  content: I like this blog it's a master piece! Glad I found this on google.
- id: 21891
  author: Seo Service
  author_email: susanzz@gmail.com
  author_url: http://fiverr.com/users/crorkservice/
  date: '2012-11-25 10:03:41 -0800'
  date_gmt: '2012-11-25 18:03:41 -0800'
  content: 2MkANN Really enjoyed this blog. Want more.
---
After posting <a href="http://justin.harmonize.fm/index.php/2009/01/cobra-a-little-javascript-class-library/">cobra</a>, one of the things I heard most was "don't try to make JavaScript be something it's not". This is good advice, but I feel that in this case it was given too hastily. Cobra did not come out of a desire to make JavaScript more like Python, even though that was the result. Cobra came out of careful consideration of how to make JavaScript better.
<h3>Problems with JavaScript</h3>
I think most people who happen upon this lonely corner of the internet are already pretty familiar with the flaws of JavaScript, but I'll mention a couple of the most glaring faults briefly.
<h4>Scope</h4>
JavaScript's scoping rules are dumb. Variables default to the global scope unless told otherwise and the <code>this</code> keyword, which is supposed to point to the current instance, actually points to the global object unless told otherwise. These scoping rules cause huge problems for beginning JavaScript programmers and trip up the most experienced programmers if they aren't paying attention. Since these odd scoping rules default to the global object, and not to some error state, errors can go by unnoticed for long periods of time.
<h4>Object Syntax</h4>
JavaScript claims to be a prototypal language. It lies. It's a language that also has prototypes. In a true prototypal language, there are objects. Objects can be derived from other objects, either by copying the parent object or by linking to it. JavaScript does something similar with its objects' built in <code>prototype</code> attribute. Its prototype points to an object that it replicates the behavior of. However, it doesn't replicate this behavior until <em>after you create a new object.</em> Let me demonstrate with some unsupported features of JavaScript:

```js
//This is my base object. It's a pretty simple 4 step dance.
Dance = {
    danceAround: function() {},
    steps: 4
}

// Let it be known that I wouldn't know what a tango was if I saw it.
// (Unless there was a rose in somebody's mouth, of course)
Tango = {
     steps: 34,
     dip: function(){}
}
// Now we pull some true prototype magic.
Tango.__proto__ = MyDance;

// This works then:
Tango.danceAround();
```

That's true prototypal behavior. There's no "new" keyword, just behaviors that can be stolen by other objects.  Unfortunately, JavaScript was thrown together in (I believe) about 15 minutes, minus a 5 minute coffee break. The writers realized that people were going to flip if it didn't resemble the popular languages of the time, so they implemented a prototype-based language, pulled the prototypes into a separate property, and added a "new" keyword. This led to syntax like the following:

```js
//This is my base object. It's a pretty simple 4 step dance.
Dance = {
    danceAround: function() {},
    steps: 4
}

Tango = function() {
    this.dip = function();
    this.steps = 37;
}
Tango.prototype = Dance;
```

That's not quite as pretty. Not only is it not as pretty, but there are some fundamental flaws. The <code>dip</code> function gets recreated every time a new <code>Tango</code> object is instantiated. This isn't a big deal most of the time, but once a year the king has a ball and all of a sudden you have 1000 partners tangoing about, and with them, 1000 identical copies of the <code>dip</code> function.

Another flaw is that the prototype is not in the lookup path of the object until a new instance is instantiated. In this example, <code>Tango.danceAround</code> is not defined. This is because prototypes are not applied to objects until a new instance of the object is instantiated. A "class" in most languages is a definition of object behavior. Instances of a class are objects that behave as defined by the class. This is very close to how prototypes behave in JavaScript.

To summarize, JavaScript isn't quite a prototype based language, it isn't quite a class based language, and the syntax for doing either is ugly (for more on the ugliness, check out <a href="http://justin.harmonize.fm/index.php/2008/12/a-better-object-oriented-javascript/">one of my previous posts</a>).
<h3>Fixing the Problems</h3>
Fortunately, JavaScript is awesome in most ways. It's so flexible that fixing the issues I've spelled out above is no problem.
<h4>Fixing Scope</h4>
You can't entirely fix JavaScript scoping. Local variables which aren't declared with <code>var</code> become global, and there's nothing you can do about that.[1. If you don't care about standards or cross-platform compatibility, check out FireFox's built in <code>__parent__</code> attribute, which lets you mess around with enclosing scopes.] You can, however, fix the <code>this</code> object. You can wrap any given object method in another method which asserts that its <code>this</code> will be set to a specific object.

```js
MyDance = {
     danceAround: function() { console.log(this.cheer) },
     cheer: "WHOOO!"
}

MyDance.danceAround = function() {
    MyDance.danceAround.apply(MyDance, arguments);
}
```

This is called binding, and it makes <code>this</code> be what you would want it to be in most instances. My initial thought was to just bind all object methods to their instances at the time of instantiation. However, I don't really like this idea. For one thing, it changes the language. For another, some libraries (I'm looking at you jQuery) like to mess around with <code>this</code>. If <code>this</code> is expected to be something, I do not want to change that. What I needed was a shadow <code>this</code>, a variable that was always present and always pointed to the instance of the object.  Luckily, there was an easy solution. <a href="http://www.python.org/">Python</a> always passes its instance object as the first parameter of any method of a class. I could replicate this behavior easily using essentially the same binding code and have the code look familiar to Python programmers everywhere. So I did. Every instance method in <a href="https://github.com/JustinTulloss/cobra">Cobra</a> has "self" passed to it as the first parameter, which is automatically guaranteed to be the instance, no matter what. No binding required.
<h4>Fixing Object Syntax</h4>
It is fairly easy to get JavaScript to <a href="http://javascript.crockford.com/prototypal.html">behave like a true prototypal language</a>. However, I don't much care for true prototypal behavior since it still leaves an ugly syntax. My solution was to create a "Class" object that will implicitly apply prototypes.

Instead of:

```js
MyNewThingy.prototype.doSomeStuff = function () {};
MyNewThingy.prototype.doMoreStuff = function() {};
```

We can do:

```js
MyNewThingy = new Class ({
    doSomeStuff: function() {},
    doMoreStuff: function() {}
});
```
These end up being <em>exactly</em> the same, except the latter is clearer and cleaner in my opinion.

Inheritance is a bit tricky in the first case. To achieve prototypal inheritance, I have to do some magic.

```js
Base = {
   basicStuff: function() {}
}
ThingyPrototype = new function() {
      this.doSomeStuff = function () {};
      this.doMoreStuff = function() {};
}
ThingyPrototype.prototype = Base;

ChildThingy.prototype = ThingyPrototype;
```

Now <code>ChildThingy</code> inherits from <code>Base</code> and has some of its own functions in its prototype. Cobra takes care of all of this for you:

```js
Base = new Class({
    basicStuff: function() {}
});
ChildThingy = new Class({
    __extends__: Base,
    childsOwnStuff: function() {}
});
```

Again, I think this is a lot clearer and cleaner.

If you put both these fixes together, you end up with <a href="https://github.com/JustinTulloss/cobra">Cobra</a>, which you can read all about <a href="http://justin.harmonize.fm/index.php/2009/01/cobra-a-little-javascript-class-library/">here</a>.

To wrap things up, augmenting JavaScript to fix its flaws is not a bad thing. The question is what to add. I haven't used Cobra for anything yet, but it's my current pet project. We'll see if it really makes JavaScript that much more pleasant.
